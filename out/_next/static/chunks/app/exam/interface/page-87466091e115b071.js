(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[660],{8416:function(e,s,t){Promise.resolve().then(t.bind(t,7109))},933:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(8030).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},8094:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(8030).Z)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]])},6127:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(8030).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},7109:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return j}});var a=t(7437),n=t(2265),l=t(6463),i=t(9630),r=t(7022),c=t(7034),d=t(933),m=t(8030);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let x=(0,m.Z)("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);var o=t(8094);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let h=(0,m.Z)("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]),u=(0,m.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),g=(0,m.Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),f=(0,m.Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);var p=t(6127);function j(){let{currentUser:e}=(0,i.a)(),{currentSession:s,questions:t,currentQuestionIndex:m,answers:j,timeRemaining:y,isExamActive:v,submitAnswer:b,navigateToQuestion:N,submitExam:w,pauseExam:k,resumeExam:C,examConfig:S}=(0,r.U)(),E=(0,l.useRouter)(),[Z,q]=(0,n.useState)(null),[L,z]=(0,n.useState)(!1),[T,M]=(0,n.useState)(new Set);if((0,n.useEffect)(()=>{s&&t.length||E.push("/dashboard")},[s,t,E]),(0,n.useEffect)(()=>{var e;q(null!==(e=j[m])&&void 0!==e?e:null)},[m,j]),(0,n.useEffect)(()=>{0===y&&v&&R()},[y,v]),!s||!t.length)return null;let _=t[m],A=(m+1)/t.length*100,F=j.filter(e=>null!==e).length,P=e=>{q(e),b(m,e)},R=async()=>{if(!L){z(!0);return}await w(),E.push("/exam/results")};return(0,a.jsx)(c.Z,{children:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-10",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between py-4",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsxs)("h1",{className:"text-xl font-bold text-gray-900",children:["mock"===s.examType?"امتحان تجريبي":"practice"===s.examType?"وضع التدريب":"اختبار مخصص","- القسم ",s.section]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 space-x-reverse",children:[(null==S?void 0:S.timeLimit)&&S.timeLimit>0&&(0,a.jsxs)("div",{className:"flex items-center ".concat(y<=300?"text-red-600":y<=900?"text-orange-600":"text-gray-900"),children:[(0,a.jsx)(d.Z,{className:"h-5 w-5 ml-2"}),(0,a.jsx)("span",{className:"font-mono text-lg font-semibold",children:(e=>{let s=Math.floor(e/3600),t=Math.floor(e%3600/60),a=e%60;return s>0?"".concat(s,":").concat(t.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0")):"".concat(t,":").concat(a.toString().padStart(2,"0"))})(y)})]}),(0,a.jsx)("button",{onClick:v?k:C,className:"flex items-center px-3 py-2 text-sm text-gray-600 hover:text-gray-900",children:v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x,{className:"h-4 w-4 ml-1"}),"إيقاف مؤقت"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 ml-1"}),"استئناف"]})})]})]}),(0,a.jsxs)("div",{className:"pb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-2",children:[(0,a.jsxs)("span",{children:["السؤال ",m+1," من ",t.length]}),(0,a.jsxs)("span",{children:["تم الإجابة على ",F," من ",t.length]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-saudi-green h-2 rounded-full transition-all duration-300",style:{width:"".concat(A,"%")}})})]})]})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"px-4 py-6 sm:px-0",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-3",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("span",{className:"bg-saudi-green text-white text-sm font-medium px-3 py-1 rounded-full ml-3",children:["سؤال ",m+1]}),T.has(m)&&(0,a.jsx)(h,{className:"h-5 w-5 text-orange-500"})]}),(0,a.jsxs)("button",{onClick:()=>{let e=new Set(T);e.has(m)?e.delete(m):e.add(m),M(e)},className:"flex items-center text-sm px-3 py-1 rounded-md ".concat(T.has(m)?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[(0,a.jsx)(h,{className:"h-4 w-4 ml-1"}),T.has(m)?"إلغاء العلامة":"وضع علامة"]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("p",{className:"text-lg font-medium text-gray-900 mb-6 leading-relaxed",children:_.content}),(0,a.jsx)("div",{className:"space-y-3",children:_.options.map((e,s)=>(0,a.jsx)("div",{className:"border-2 rounded-lg p-4 cursor-pointer transition-colors ".concat(Z===s?"border-saudi-green bg-green-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),onClick:()=>P(s),children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"answer",value:s,checked:Z===s,onChange:()=>P(s),className:"h-4 w-4 text-saudi-green focus:ring-saudi-green"}),(0,a.jsxs)("span",{className:"mr-3 font-medium text-gray-700",children:[String.fromCharCode(65+s),"."]}),(0,a.jsx)("span",{className:"text-gray-900",children:e})]})},s))})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("button",{onClick:()=>{m>0&&N(m-1)},disabled:0===m,className:"flex items-center px-4 py-2 text-gray-600 hover:text-gray-900 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(u,{className:"h-5 w-5 ml-1"}),"السؤال السابق"]}),(0,a.jsx)("div",{className:"flex items-center space-x-3 space-x-reverse",children:m===t.length-1?(0,a.jsxs)("button",{onClick:R,className:"flex items-center px-6 py-3 bg-red-600 text-white rounded-md hover:bg-red-700",children:[(0,a.jsx)(g,{className:"h-4 w-4 ml-2"}),"إنهاء الامتحان"]}):(0,a.jsxs)("button",{onClick:()=>{m<t.length-1&&N(m+1)},className:"flex items-center px-6 py-3 bg-saudi-green text-white rounded-md hover:bg-green-700",children:["السؤال التالي",(0,a.jsx)(f,{className:"h-5 w-5 mr-1"})]})})]})]})})}),(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 sticky top-24",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"خريطة الأسئلة"}),(0,a.jsx)("div",{className:"grid grid-cols-5 gap-2 mb-4",children:t.map((e,s)=>(0,a.jsx)("button",{onClick:()=>N(s),className:"w-8 h-8 text-xs font-medium rounded ".concat(s===m?"bg-saudi-green text-white":null!==j[s]?"bg-green-100 text-green-800":T.has(s)?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:s+1},s))}),(0,a.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-saudi-green rounded ml-2"}),(0,a.jsx)("span",{children:"السؤال الحالي"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-green-100 border border-green-300 rounded ml-2"}),(0,a.jsx)("span",{children:"تم الإجابة"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-orange-100 border border-orange-300 rounded ml-2"}),(0,a.jsx)("span",{children:"معلم بعلامة"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-gray-100 border border-gray-300 rounded ml-2"}),(0,a.jsx)("span",{children:"لم تتم الإجابة"})]})]}),(0,a.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"تم الإجابة:"}),(0,a.jsx)("span",{className:"font-medium",children:F})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"لم تتم الإجابة:"}),(0,a.jsx)("span",{className:"font-medium",children:t.length-F})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"معلم:"}),(0,a.jsx)("span",{className:"font-medium",children:T.size})]})]})})]})})]})})}),L&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsxs)("div",{className:"flex items-center mb-4",children:[(0,a.jsx)(p.Z,{className:"h-6 w-6 text-orange-600 ml-2"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"تأكيد إنهاء الامتحان"})]}),(0,a.jsx)("p",{className:"text-gray-700 mb-4",children:"هل أنت متأكد من إنهاء الامتحان؟ لن تتمكن من العودة بعد الإنهاء."}),(0,a.jsx)("div",{className:"mb-4 p-3 bg-gray-50 rounded-md",children:(0,a.jsxs)("div",{className:"text-sm space-y-1",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"الأسئلة المجابة:"}),(0,a.jsxs)("span",{className:"font-medium",children:[F," من ",t.length]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"الأسئلة المتبقية:"}),(0,a.jsx)("span",{className:"font-medium",children:t.length-F})]})]})}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 space-x-reverse",children:[(0,a.jsx)("button",{onClick:()=>z(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-900",children:"إلغاء"}),(0,a.jsx)("button",{onClick:R,className:"px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"إنهاء الامتحان"})]})]})})]})})}},7022:function(e,s,t){"use strict";t.d(s,{ExamProvider:function(){return d},U:function(){return c}});var a=t(7437),n=t(2265),l=t(9630),i=t(3494);let r=(0,n.createContext)(void 0),c=()=>{let e=(0,n.useContext)(r);if(void 0===e)throw Error("useExam must be used within an ExamProvider");return e},d=e=>{let{children:s}=e,{currentUser:t}=(0,l.a)(),[c,d]=(0,n.useState)(null),[m,x]=(0,n.useState)([]),[o,h]=(0,n.useState)(0),[u,g]=(0,n.useState)([]),[f,p]=(0,n.useState)(0),[j,y]=(0,n.useState)(!1),[v,b]=(0,n.useState)(null),[N,w]=(0,n.useState)(!1),[k,C]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=null;return j&&f>0&&(e=setInterval(()=>{p(e=>e<=1?(E(),0):e-1)},1e3)),()=>{e&&clearInterval(e)}},[j,f]);let S=async(e,s,a)=>{if(!t){C("يجب تسجيل الدخول لبدء الامتحان");return}try{let n;w(!0),C(null),n="mock"===e?{questionCount:110,timeLimit:120,showFeedback:!1,allowReview:!1}:"practice"===e?{questionCount:(null==a?void 0:a.questionCount)||20,domain:null==a?void 0:a.domain,difficulty:null==a?void 0:a.difficulty,showFeedback:!0,allowReview:!0,timeLimit:0}:a||{questionCount:20,timeLimit:30,showFeedback:!1,allowReview:!0},b(n);let l=await (0,i.iv)(n.questionCount,n.domain,n.difficulty);if(0===l.length)throw Error("لا توجد أسئلة متاحة للمعايير المحددة");let r={userId:t.uid,examType:e,section:s,questions:l.map(e=>e.id),answers:Array(l.length).fill(null),startTime:new Date,completed:!1,timeSpent:0},c=await (0,i.nW)(r);d({...r,id:c}),x(l),g(Array(l.length).fill(null)),h(0),p(n.timeLimit?60*n.timeLimit:0),y(!0)}catch(e){C(e.message||"فشل في بدء الامتحان")}finally{w(!1)}},E=async()=>{if(c)try{w(!0),y(!1);let e=0;m.forEach((s,t)=>{u[t]===s.correctAnswer&&e++});let s=Math.round(e/m.length*100),t=(null==v?void 0:v.timeLimit)?60*v.timeLimit-f:0;await (0,i.f_)(c.id,{answers:u,endTime:new Date,score:s,completed:!0,timeSpent:t}),d(e=>e?{...e,answers:u,endTime:new Date,score:s,completed:!0,timeSpent:t}:null)}catch(e){C(e.message||"فشل في حفظ نتائج الامتحان")}finally{w(!1)}};return(0,n.useEffect)(()=>{t||(d(null),x([]),g([]),h(0),p(0),y(!1),b(null))},[t]),(0,a.jsx)(r.Provider,{value:{currentSession:c,questions:m,currentQuestionIndex:o,answers:u,timeRemaining:f,isExamActive:j,startExam:S,submitAnswer:(e,s)=>{g(t=>{let a=[...t];return a[e]=s,a})},navigateToQuestion:e=>{e>=0&&e<m.length&&h(e)},submitExam:E,pauseExam:()=>{y(!1)},resumeExam:()=>{y(!0)},examConfig:v,setExamConfig:b,loading:N,error:k},children:s})}}},function(e){e.O(0,[358,139,230,685,971,23,744],function(){return e(e.s=8416)}),_N_E=e.O()}]);