(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{511:function(e,t,r){Promise.resolve().then(r.t.bind(r,4811,23)),Promise.resolve().then(r.t.bind(r,2778,23)),Promise.resolve().then(r.bind(r,4362)),Promise.resolve().then(r.bind(r,1786))},4362:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return c},a:function(){return l}});var a=r(7437),n=r(2265),i=r(3301),o=r(6410),u=r(925);let s=(0,n.createContext)(void 0),l=()=>{let e=(0,n.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},c=e=>{let{children:t}=e,[r,l]=(0,n.useState)(null),[c,m]=(0,n.useState)(null),[f,w]=(0,n.useState)(!0),h=async(e,t)=>{try{let r=await (0,i.e5)(o.I8,e,t);r.user&&await (0,u.V4)(r.user.uid)}catch(e){throw console.error("Login error:",e),Error(d(e.code))}},v=async(e,t,r)=>{try{let a=await (0,i.Xb)(o.I8,e,t);a.user&&(await (0,i.ck)(a.user,{displayName:r.displayName}),await (0,u.r4)({uid:a.user.uid,email:a.user.email,displayName:r.displayName,role:r.role||"student",university:r.university,graduationYear:r.graduationYear}),await (0,i.w$)(a.user))}catch(e){throw console.error("Registration error:",e),Error(d(e.code))}},y=async()=>{try{await (0,i.w7)(o.I8),l(null),m(null)}catch(e){throw console.error("Logout error:",e),Error("فشل في تسجيل الخروج")}},p=async e=>{try{await (0,i.LS)(o.I8,e)}catch(e){throw console.error("Password reset error:",e),Error(d(e.code))}},b=async e=>{if(!c)throw Error("لا يوجد مستخدم مسجل دخول");try{await (0,i.ck)(c,{displayName:e}),r&&await (0,u.r4)({...r,displayName:e})}catch(e){throw console.error("Profile update error:",e),Error("فشل في تحديث الملف الشخصي")}},g=async()=>{if(!c)throw Error("لا يوجد مستخدم مسجل دخول");try{await (0,i.w$)(c)}catch(e){throw console.error("Email verification error:",e),Error("فشل في إرسال رسالة التحقق")}};return(0,n.useEffect)(()=>(0,i.Aj)(o.I8,async e=>{if(m(e),e)try{let t=await (0,u.PR)(e.uid);l(t)}catch(e){console.error("Error fetching user data:",e),l(null)}else l(null);w(!1)}),[]),(0,a.jsx)(s.Provider,{value:{currentUser:r,firebaseUser:c,loading:f,login:h,register:v,logout:y,resetPassword:p,updateUserProfile:b,sendVerificationEmail:g},children:t})},d=e=>{switch(e){case"auth/user-not-found":return"لا يوجد حساب مرتبط بهذا البريد الإلكتروني";case"auth/wrong-password":return"كلمة المرور غير صحيحة";case"auth/email-already-in-use":return"هذا البريد الإلكتروني مستخدم بالفعل";case"auth/weak-password":return"كلمة المرور ضعيفة. يجب أن تكون 6 أحرف على الأقل";case"auth/invalid-email":return"البريد الإلكتروني غير صحيح";case"auth/user-disabled":return"تم تعطيل هذا الحساب";case"auth/too-many-requests":return"تم تجاوز عدد المحاولات المسموح. حاول مرة أخرى لاحقاً";case"auth/network-request-failed":return"خطأ في الاتصال بالإنترنت";default:return"حدث خطأ غير متوقع. حاول مرة أخرى"}}},1786:function(e,t,r){"use strict";r.d(t,{ExamProvider:function(){return l},U:function(){return s}});var a=r(7437),n=r(2265),i=r(4362),o=r(925);let u=(0,n.createContext)(void 0),s=()=>{let e=(0,n.useContext)(u);if(void 0===e)throw Error("useExam must be used within an ExamProvider");return e},l=e=>{let{children:t}=e,{currentUser:r}=(0,i.a)(),[s,l]=(0,n.useState)(null),[c,d]=(0,n.useState)([]),[m,f]=(0,n.useState)(0),[w,h]=(0,n.useState)([]),[v,y]=(0,n.useState)(0),[p,b]=(0,n.useState)(!1),[g,E]=(0,n.useState)(null),[I,T]=(0,n.useState)(!1),[x,D]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=null;return p&&v>0&&(e=setInterval(()=>{y(e=>e<=1?(S(),0):e-1)},1e3)),()=>{e&&clearInterval(e)}},[p,v]);let P=async(e,t,a)=>{if(!r){D("يجب تسجيل الدخول لبدء الامتحان");return}try{let n;T(!0),D(null),n="mock"===e?{questionCount:110,timeLimit:120,showFeedback:!1,allowReview:!1}:"practice"===e?{questionCount:(null==a?void 0:a.questionCount)||20,domain:null==a?void 0:a.domain,difficulty:null==a?void 0:a.difficulty,showFeedback:!0,allowReview:!0,timeLimit:0}:a||{questionCount:20,timeLimit:30,showFeedback:!1,allowReview:!0},E(n);let i=await (0,o.iv)(n.questionCount,n.domain,n.difficulty);if(0===i.length)throw Error("لا توجد أسئلة متاحة للمعايير المحددة");let u={userId:r.uid,examType:e,section:t,questions:i.map(e=>e.id),answers:Array(i.length).fill(null),startTime:new Date,completed:!1,timeSpent:0},s=await (0,o.nW)(u);l({...u,id:s}),d(i),h(Array(i.length).fill(null)),f(0),y(n.timeLimit?60*n.timeLimit:0),b(!0)}catch(e){D(e.message||"فشل في بدء الامتحان")}finally{T(!1)}},S=async()=>{if(s)try{T(!0),b(!1);let e=0;c.forEach((t,r)=>{w[r]===t.correctAnswer&&e++});let t=Math.round(e/c.length*100),r=(null==g?void 0:g.timeLimit)?60*g.timeLimit-v:0;await (0,o.f_)(s.id,{answers:w,endTime:new Date,score:t,completed:!0,timeSpent:r}),l(e=>e?{...e,answers:w,endTime:new Date,score:t,completed:!0,timeSpent:r}:null)}catch(e){D(e.message||"فشل في حفظ نتائج الامتحان")}finally{T(!1)}};return(0,n.useEffect)(()=>{r||(l(null),d([]),h([]),f(0),y(0),b(!1),E(null))},[r]),(0,a.jsx)(u.Provider,{value:{currentSession:s,questions:c,currentQuestionIndex:m,answers:w,timeRemaining:v,isExamActive:p,startExam:P,submitAnswer:(e,t)=>{h(r=>{let a=[...r];return a[e]=t,a})},navigateToQuestion:e=>{e>=0&&e<c.length&&f(e)},submitExam:S,pauseExam:()=>{b(!1)},resumeExam:()=>{b(!0)},examConfig:g,setExamConfig:E,loading:I,error:x},children:t})}},6410:function(e,t,r){"use strict";r.d(t,{I8:function(){return c},db:function(){return d},tO:function(){return m}});var a=r(738),n=r(3301),i=r(5978),o=r(62),u=r(6834);let s={apiKey:"AIzaSyBVPwdXDXdGJzH4bdEJTmGO6CLdwJcFvp0",authDomain:"sple-exam-system.firebaseapp.com",projectId:"sple-exam-system",storageBucket:"sple-exam-system.firebasestorage.app",messagingSenderId:"684476565122",appId:"1:684476565122:web:65f005113e5e29e421569b",measurementId:"G-JM2SWJY950"};if(!s.apiKey||!s.authDomain||!s.projectId)throw Error("Firebase configuration is incomplete. Please check your environment variables.");let l=(0,a.ZF)(s),c=(0,n.v0)(l),d=(0,i.ad)(l),m=(0,o.cF)(l);(0,u.IH)(l)},925:function(e,t,r){"use strict";r.d(t,{$V:function(){return y},Ds:function(){return w},Km:function(){return h},L$:function(){return b},PR:function(){return c},V4:function(){return d},f_:function(){return p},iv:function(){return f},nW:function(){return v},r4:function(){return l},tI:function(){return m}});var a=r(5978),n=r(6410);let i=(0,a.hJ)(n.db,"users"),o=(0,a.hJ)(n.db,"questions"),u=(0,a.hJ)(n.db,"examSessions"),s=(0,a.hJ)(n.db,"userProgress"),l=async e=>{let t=(0,a.JU)(i,e.uid);await (0,a.r7)(t,{...e,createdAt:(0,a.Bt)(),lastLogin:(0,a.Bt)()})},c=async e=>{let t=(0,a.JU)(i,e),r=await (0,a.QT)(t);if(r.exists()){var n,o;let e=r.data();return{uid:r.id,...e,createdAt:(null===(n=e.createdAt)||void 0===n?void 0:n.toDate())||new Date,lastLogin:(null===(o=e.lastLogin)||void 0===o?void 0:o.toDate())||new Date}}return null},d=async e=>{let t=(0,a.JU)(i,e);await (0,a.r7)(t,{lastLogin:(0,a.Bt)()})},m=async function(e,t){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,i=[(0,a.ar)("approved","==",r),(0,a.Xo)("createdAt","desc"),(0,a.b9)(n)];e&&i.splice(1,0,(0,a.ar)("domain","==",e)),t&&i.splice(e?2:1,0,(0,a.ar)("difficulty","==",t));let u=(0,a.IO)(o,...i);return(await (0,a.PL)(u)).docs.map(e=>{var t;return{id:e.id,...e.data(),createdAt:(null===(t=e.data().createdAt)||void 0===t?void 0:t.toDate())||new Date}})},f=async(e,t,r)=>{let a=(await m(t,r,!0,3*e)).sort(()=>.5-Math.random());return a.slice(0,Math.min(e,a.length))},w=async(e,t)=>{let r=(0,a.JU)(o,e);await (0,a.r7)(r,t)},h=async e=>{let t=(0,a.JU)(o,e);await (0,a.oe)(t)},v=async e=>(await (0,a.ET)(u,{...e,startTime:e.startTime||(0,a.Bt)(),endTime:e.endTime||null})).id,y=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,n=[(0,a.ar)("userId","==",e),(0,a.Xo)("startTime","desc"),(0,a.b9)(r)];t&&n.splice(1,0,(0,a.ar)("examType","==",t));let i=(0,a.IO)(u,...n);return(await (0,a.PL)(i)).docs.map(e=>{var t,r;return{id:e.id,...e.data(),startTime:(null===(t=e.data().startTime)||void 0===t?void 0:t.toDate())||new Date,endTime:(null===(r=e.data().endTime)||void 0===r?void 0:r.toDate())||void 0}})},p=async(e,t)=>{let r=(0,a.JU)(u,e),n={...t};t.endTime&&(n.endTime=a.EK.fromDate(t.endTime)),await (0,a.r7)(r,n)},b=async e=>{let t=(0,a.JU)(s,e),r=await (0,a.QT)(t);if(r.exists()){var n;let t=r.data();return{userId:e,...t,lastUpdated:(null===(n=t.lastUpdated)||void 0===n?void 0:n.toDate())||new Date}}return null}},2778:function(){},4811:function(e){e.exports={style:{fontFamily:"'__Inter_e8ce0c', '__Inter_Fallback_e8ce0c'",fontStyle:"normal"},className:"__className_e8ce0c"}}},function(e){e.O(0,[2,358,139,432,971,117,744],function(){return e(e.s=511)}),_N_E=e.O()}]);